{% extends "base.html" %}
{% block content %}
<h1>{{ t('Reports') }}</h1>

<div class="kpi-grid">
  <div class="kpi-card"><div class="kpi-title">{{ t('Total Sales') }}</div><div class="kpi-value">{{ kpi.total_vendas|fmt_int }}</div></div>
  <div class="kpi-card"><div class="kpi-title">{{ t('Revenue (sold items)') }}</div><div class="kpi-value">{{ kpi.receita|fmt_money }}</div></div>
  <div class="kpi-card"><div class="kpi-title">{{ t('Total Cost') }}</div><div class="kpi-value">{{ kpi.custo_total|fmt_money }}</div></div>
  <div class="kpi-card"><div class="kpi-title">{{ t('Estimated Profit') }}</div><div class="kpi-value">{{ (kpi.receita - kpi.custo_total)|fmt_money }}</div></div>
</div>

<h3 style="margin:12px 0;">{{ t('Ingredient usage (last 4 weeks)') }}</h3>

{# -------- compatível com Jinja antigo -------- #}
{% set usos = consumo | map(attribute='uso_total') | list %}
{% set maxuso = usos|length and (usos|max) or 0 %}

<div class="usage-list">
  {% for c in consumo %}
    {% set perc = (c.uso_total / (maxuso if maxuso else 1)) * 100 %}
    <div class="usage-item">
      <div class="usage-head">
        <div style="font-weight:700">{{ c.nome }}</div>
        <div class="muted">{{ c.uso_total|fmt_int }} {{ c.unidade }} • {{ c.custo_total|fmt_money }}</div>
      </div>
      <div class="usage-bar">
        <div style="--w: {{ perc|round(0)|int }}; width: calc(var(--w) * 1%);"></div>
      </div>
    </div>
  {% endfor %}
</div>
{% endblock %}
