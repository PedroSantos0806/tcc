{% extends "base.html" %}
{% block content %}

<section class="page-header">
  <h1>{{ t('Reports') }}</h1>
  <p class="muted">{{ t('Reports subtitle') }}</p>
</section>

{% if consumo and consumo[0].uso_total > 0 %}
  {% set max_uso = consumo[0].uso_total %}
{% else %}
  {% set max_uso = 1 %}
{% endif %}

<div class="kpi-grid">
  <div class="kpi-card">
    <div class="kpi-title">{{ t('Total sales') }}</div>
    <div class="kpi-value">{{ kpi.total_vendas|fmt_int }}</div>
  </div>
  <div class="kpi-card">
    <div class="kpi-title">{{ t('Revenue (sold items)') }}</div>
    <div class="kpi-value">{{ kpi.receita|fmt_money }}</div>
  </div>
  <div class="kpi-card">
    <div class="kpi-title">{{ t('Total cost') }}</div>
    <div class="kpi-value">{{ kpi.custo_total|fmt_money }}</div>
  </div>
  <div class="kpi-card">
    <div class="kpi-title">{{ t('Estimated profit') }}</div>
    <div class="kpi-value">{{ (kpi.receita - kpi.custo_total)|fmt_money }}</div>
  </div>
</div>

<section style="margin-top:18px;">
  <h3 style="margin-bottom:8px;">{{ t('Usage last 28 days') }}</h3>
  <p class="muted" style="margin-bottom:12px;">
    {{ t('Usage subtitle') }}
  </p>

  {% if consumo %}
    <div class="usage-list">
      {% for item in consumo %}
        <div class="usage-item">
          <div class="usage-head">
            <div>
              <strong>{{ item.nome }}</strong>
              <span style="font-size:12px; color:#64748b; margin-left:6px;">
                {{ item.uso_total }} {{ item.unidade }}
              </span>
            </div>
            <div class="badge badge-info">
              {{ t('Cost') }} {{ item.custo_total|fmt_money }}
            </div>
          </div>
          <div class="usage-bar">
            <div class="usage-bar-fill"
                 data-width="{{ (item.uso_total / max_uso * 100)|round(0) }}"></div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="panel panel-empty">
      <div class="emoji">ðŸ“Š</div>
      <p class="muted">{{ t('No data for reports') }}</p>
    </div>
  {% endif %}
</section>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    var bars = document.querySelectorAll('.usage-bar-fill');
    bars.forEach(function (el) {
      var pct = el.getAttribute('data-width');
      if (pct) {
        el.style.width = pct + '%';
      }
    });
  });
</script>

{% endblock %}
