{% endblock %}


{% extends "base.html" %}
{% block content %}
<h1>{{ t('Create Product') }}</h1>

<form method="POST" class="form-box" id="form-produto">
  <label for="nome">{{ t('Product Name') }}</label>
  <input id="nome" name="nome" required>

  <label for="preco_custo">{{ t('Cost Price (R$)') }}</label>
  <input id="preco_custo" name="preco_custo" type="number" step="0.01" required>

  <label for="preco_venda">{{ t('Sale Price (R$)') }}</label>
  <input id="preco_venda" name="preco_venda" type="number" step="0.01" required>

  <label for="quantidade">{{ t('Quantity') }}</label>
  <input id="quantidade" name="quantidade" type="number" min="0" required>

  <label for="categoria">{{ t('Category') }}</label>
  <select id="categoria" name="categoria" required>
    <option value="">{{ t('Select...') }}</option>
    <option value="Vestuário">Vestuário</option>
    <option value="Calçados">Calçados</option>
    <option value="Tecnologia">Tecnologia</option>
  </select>

  <div id="grupo-subcategoria" style="display:none;">
    <label for="subcategoria">{{ t('Subcategory') }}</label>
    <select id="subcategoria" name="subcategoria"></select>
  </div>

  <div id="grupo-tamanho" style="display:none;">
    <label for="tamanho">{{ t('Size') }}</label>
    <select id="tamanho" name="tamanho"></select>
  </div>

  <label for="data_chegada">{{ t('Arrival Date') }}</label>
  <input id="data_chegada" name="data_chegada" type="date" required>

  <button type="submit">{{ t('Save') }}</button>
</form>

<script>
(function(){
  const nome = document.getElementById('nome');
  const cat  = document.getElementById('categoria');
  const gSub = document.getElementById('grupo-subcategoria');
  const gTam = document.getElementById('grupo-tamanho');
  const sub  = document.getElementById('subcategoria');
  const tam  = document.getElementById('tamanho');

  const opcoes = {
    'Vestuário': {
      subcategorias: ['Camisetas','Calças','Jaquetas','Acessórios'],
      tamanhos: ['PP','P','M','G','GG']
    },
    'Calçados': {
      subcategorias: null,
      tamanhos: ['34','35','36','37','38','39','40','41','42','43','44']
    },
    'Tecnologia': {
      subcategorias: ['Periféricos','Áudio','Câmeras','Acessórios'],
      tamanhos: null
    }
  };

  function popularSelect(select, valores){
    select.innerHTML = '';
    valores.forEach(v=>{
      const o = document.createElement('option');
      o.value = v; o.textContent = v;
      select.appendChild(o);
    });
  }

  // "IA" simples por palavras-chave no nome
  function guessCategoria(text){
    text = (text || '').toLowerCase();
    if (/\b(camis|camisa|blusa|calça|jaqueta|casaco|vestido|meia)\b/.test(text)) return 'Vestuário';
    if (/\b(tenis|tênis|bota|sandalia|sandalha|chinelo)\b/.test(text)) return 'Calçados';
    if (/\b(mouse|teclado|fone|headset|webcam|camera|câmera|usb|hdmi)\b/.test(text)) return 'Tecnologia';
    return '';
  }

  function aplicarCampos(catVal){
    if(!catVal){ gSub.style.display='none'; gTam.style.display='none'; return; }
    const cfg = opcoes[catVal];
    if (!cfg) { gSub.style.display='none'; gTam.style.display='none'; return; }

    if (catVal === 'Vestuário'){
      if (cfg.subcategorias){ popularSelect(sub, cfg.subcategorias); gSub.style.display='block'; } else { gSub.style.display='none'; }
      gTam.style.display='none';
      sub.onchange = ()=>{ if(cfg.tamanhos){ popularSelect(tam, cfg.tamanhos); gTam.style.display='block'; } };
    } else if (catVal === 'Calçados'){
      gSub.style.display='none';
      if (cfg.tamanhos){ popularSelect(tam, cfg.tamanhos); gTam.style.display='block'; } else { gTam.style.display='none'; }
    } else if (catVal === 'Tecnologia'){
      if (cfg.subcategorias){ popularSelect(sub, cfg.subcategorias); gSub.style.display='block'; } else { gSub.style.display='none'; }
      gTam.style.display='none';
    }
  }

  cat.addEventListener('change', ()=> aplicarCampos(cat.value));
  nome.addEventListener('blur', ()=>{
    if(!cat.value){
      const g = guessCategoria(nome.value);
      if (g) { cat.value = g; aplicarCampos(g); }
    }
  });
})();
</script>
{% endblock %}
