{% extends "base.html" %}
{% block content %}
<h1>{{ t('Register Sale') }}</h1>

<form method="POST" class="form-box" id="form-venda">
  <label for="data_venda">{{ t('Sale date') }}</label>
  <input id="data_venda" name="data_venda" type="date" required>

  <div id="itens">
    <div class="item">
      <label>{{ t('Products') }}</label>
      <select name="produto_id[]" required>
        <option value="">{{ t('Select...') }}</option>
        {% for p in produtos %}
          <option value="{{ p.id }}">{{ p.nome }} — R$ {{ '%.2f'|format(p.preco_venda|float) }}</option>
        {% endfor %}
      </select>

      <label>{{ t('Quantity') }}</label>
      <input name="quantidade[]" type="number" min="1" value="1" required>
    </div>
  </div>

  <button type="button" id="addItemBtn">{{ t('Add Item') }}</button>
  <button type="submit">{{ t('Save') }}</button>
</form>

<script>
(function(){
  const btn = document.getElementById('addItemBtn');
  const wrap = document.getElementById('itens');
  btn.addEventListener('click', () => {
    const div = document.createElement('div'); 
    div.className='item';
    div.innerHTML = `
      <label>{{ t('Products') }}</label>
      <select name="produto_id[]" required>
        <option value="">{{ t('Select...') }}</option>
        {% for p in produtos %}
          <option value="{{ p.id }}">{{ p.nome }} — R$ {{ '%.2f'|format(p.preco_venda|float) }}</option>
        {% endfor %}
      </select>
      <label>{{ t('Quantity') }}</label>
      <input name="quantidade[]" type="number" min="1" value="1" required>
    `;
    wrap.appendChild(div);
  });
})();
</script>
{% endblock %}
