{% extends "base.html" %}
{% block content %}

{# [MOD] Nova tela de registro de venda, com linhas dinâmicas de produtos #}

<section class="page-header">
  <h1>Registrar venda</h1>
  <p class="muted">
    Selecione os produtos vendidos e a quantidade. O PrevSuite atualiza estoque e métricas automaticamente.
  </p>
</section>

<section class="grid-2">
  <article class="panel">
    <h3>Dados da venda</h3>
    <form method="post" id="form-venda" class="form-box" style="margin-top:10px;">
      <label>
        Data da venda*
        <input type="date" name="data_venda" required>
      </label>

      <div class="sale-items-wrap">
        <div class="sale-item-row">
          <label style="width:100%;">
            Produto
            <select name="produto_id[]" required>
              <option value="">Selecione um produto</option>
              {% for p in produtos %}
                <option value="{{ p.id }}">{{ p.nome }}</option>
              {% endfor %}
            </select>
          </label>
          <label style="min-width:120px;">
            Quantidade
            <input type="number" name="quantidade[]" min="1" value="1" required>
          </label>
        </div>
      </div>

      <button type="button" class="btn" onclick="addSaleRow()">Adicionar outro produto</button>
      <button type="submit" style="margin-top:8px;">Registrar venda</button>
    </form>
  </article>

  <article class="panel">
    <h3>Dica</h3>
    <p class="muted" style="margin-top:6px;">
      Utilize esta tela sempre que realizar uma venda. Assim você acompanha:
    </p>
    <ul style="margin-top:10px; padding-left:18px; color:#475569; font-size:14px;">
      <li>Quais produtos mais vendem;</li>
      <li>Estoque atual em tempo real;</li>
      <li>Receita e lucro por produto.</li>
    </ul>
  </article>
</section>

<script>
  // [MOD] Script simples para adicionar novas linhas de produto
  function addSaleRow() {
    const wrap = document.querySelector('.sale-items-wrap');
    const first = wrap.querySelector('.sale-item-row');
    const clone = first.cloneNode(true);

    // limpa valores
    clone.querySelectorAll('select,input').forEach(el => {
      if (el.tagName === 'SELECT') {
        el.selectedIndex = 0;
      } else {
        el.value = el.name === 'quantidade[]' ? 1 : '';
      }
    });

    wrap.appendChild(clone);
  }
</script>

{% endblock %}
