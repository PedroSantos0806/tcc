{% extends "base.html" %}
{% block content %}
<h1>Menu</h1>

<form method="POST" class="form-box" style="max-width:520px;">
  <h3>Novo Item de Menu</h3>
  <label>Nome</label>
  <input name="nome" required>
  <label>Preço (R$)</label>
  <input name="preco" type="number" step="0.01" min="0" required>
  <button type="submit">Salvar</button>
</form>

<hr style="margin:16px 0; border-color:#334155;">

<h3>Receitas</h3>
<p>Vincule os ingredientes que compõem cada item (quantidade por unidade vendida).</p>

{% for item in itens %}
<div class="card" style="margin:10px 0;">
  <h3>{{ item.nome }} — {{ item.preco|fmt_money }}</h3>
  <form method="POST" action="{{ url_for('restaurant_bp.receita_add') }}" class="form-box" style="grid-template-columns:1fr 1fr 1fr auto; display:grid; gap:10px; align-items:end;">
    <input type="hidden" name="item_id" value="{{ item.id }}">
    <div>
      <label>Ingrediente</label>
      <select name="ingrediente_id" required>
        {% for i in ingredientes %}
          <option value="{{ i.id }}">{{ i.nome }} ({{ i.unidade }})</option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label>Quantidade por unidade</label>
      <input type="number" name="quantidade" step="0.01" min="0.01" required>
    </div>
    <div>
      <label>&nbsp;</label>
      <button type="submit">Adicionar</button>
    </div>
  </form>

  {% set recs = receitas.get(item.id, []) %}
  {% if recs %}
  <table class="table-padrao" style="margin-top:8px;">
    <thead><tr><th>Ingrediente</th><th>Unidade</th><th>Qtd/Un.</th><th>Ações</th></tr></thead>
    <tbody>
      {% for r in recs %}
      <tr>
        <td>{{ r.ing_nome }}</td>
        <td>{{ r.unidade }}</td>
        <td>{{ r.quantidade }}</td>
        <td>
          <form method="POST" action="{{ url_for('restaurant_bp.receita_del', rid=r.id) }}">
            <button type="submit">Remover</button>
          </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <p class="muted">Nenhum ingrediente vinculado ainda.</p>
  {% endif %}
</div>
{% endfor %}
{% endblock %}
