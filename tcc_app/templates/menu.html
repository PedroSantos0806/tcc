{% extends "base.html" %}
{% block content %}
<h1>Menu do Restaurante</h1>

<div class="panel" style="margin:10px 0;">
  <h3>Novo item de menu</h3>
  <form method="POST" class="form-box" style="max-width:520px;">
    <input type="hidden" name="acao" value="criar">
    <label>Nome</label>
    <input class="input" name="nome" required placeholder="Ex.: Chicken Burger">
    <label>Pre√ßo de venda (opcional)</label>
    <input class="input" name="preco" type="number" step="0.01" placeholder="Ex.: 19.90">
    <button class="btn primary" type="submit">Criar</button>
  </form>
</div>

{% if itens|length == 0 %}
  <p class="muted">Nenhum item de menu ainda.</p>
{% else %}
  <div class="menu-grid">
    {% for item in itens %}
      <div class="menu-card">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <div>
            <div style="font-weight:800">{{ item.nome }}</div>
            <div class="price">R$ {{ '%.2f'|format(item.preco or 0) }}</div>
          </div>
          <details style="margin-left:12px;">
            <summary class="details-summary">Adicionar ingrediente</summary>
            <form method="POST" action="{{ url_for('restaurant_bp.menu_receita_add') }}" class="form-box" style="min-width:300px;">
              <input type="hidden" name="menu_item_id" value="{{ item.id }}">
              <label>Produto</label>
              <select class="input" name="produto_id" required>
                {% for p in produtos %}<option value="{{ p.id }}">{{ p.nome }}</option>{% endfor %}
              </select>
              <label>Quantidade por item</label>
              <input class="input" type="number" step="0.01" min="0.01" name="qtd_por_item" required placeholder="Ex.: 2 (fatias, unidades, g...)">
              <button class="btn primary" type="submit">Adicionar</button>
            </form>
          </details>
        </div>

        <div class="menu-ingredients">
          <h4>Receita</h4>
          {% set rec = receitas.get(item.id, []) %}
          {% if rec|length == 0 %}
            <div class="muted">Nenhum ingrediente cadastrado.</div>
          {% else %}
            {% for r in rec %}
              <div class="menu-ingredient-row">
                <div>{{ r.produto_nome }}</div>
                <div class="act">
                  <span class="badge badge-info">{{ r.qtd_por_item|round(2) }}</span>
                  <form method="POST" action="{{ url_for('restaurant_bp.menu_receita_del', receita_id=r.id) }}">
                    <button class="btn" type="submit" title="Remover">Remover</button>
                  </form>
                </div>
              </div>
            {% endfor %}
          {% endif %}
        </div>
      </div>
    {% endfor %}
  </div>
{% endif %}
{% endblock %}
